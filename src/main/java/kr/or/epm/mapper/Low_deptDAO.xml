<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.epm.DAO.Low_deptDAO">

<!--
	작성일 : 2016-11-20
	작성자 : 백승아
	사용 목적 : 하위부서에 대한 mapper
-->
	<!-- 하위 부서 selectbox -->
    <select id="select_lowdept_name" parameterType="String" resultType="kr.or.epm.VO.Low_dept">
      select low_dept_no, low_dept_name 
      from low_dept 
      where dept_no=#{dept_no} and his_check='1'
    </select>

	<!-- 하위 부서 조회하기-->
	<select id="selectLow_dept" resultType="kr.or.epm.VO.Low_dept">
		select branch_name, dept_name, low_dept_name
		from low_dept
		where his_check = '1'
		order by low_dept_name asc
	</select>
	
	<!-- 하위 부서  조회하기  1)-->
	<select id="selectLow_dept_detail" resultType="kr.or.epm.VO.LowDeptJoin">
		select dept_no, branch_name, dept_name, low_dept_name, 
			   tel, fax
		from low_dept
		where low_dept_no = #{low_dept_no} and his_check = '1'
	</select>
	
	
	<!--하위부서 조회하기 2)홈페이지  -->
	<select id="selectHomePage" resultType="kr.or.epm.VO.Set_homepage">
		select open, close from set_homepage where low_dept_no=#{low_dept_no}
	</select>
	
	<!--하위부서 조회하기 3)출퇴근시간  -->
	<select id="selectTime" resultType="kr.or.epm.VO.Set_time">
		select in_time, out_time from set_time where low_dept_no=#{low_dept_no}
	</select>
	
	
	<!-- 하위 부서 등록하기 1)-->
	<insert id="insertLow_dept" parameterType="kr.or.epm.VO.LowDeptJoin">
		insert into low_dept(low_dept_no, dept_no, branch_name, 
							 dept_name, low_dept_name, tel, 
							 fax, pre_low_dept_no, his_check, 
							 depth)
		values(low_dept_seq.nextval, #{dept_no}, #{branch_name}, 
			   #{dept_name}, #{low_dept_name}, #{tel}, 
			   #{fax}, null, '1', 
			   '2')
	</insert>
	
		
	<!--등록된 하위부서 번호 조회하기 2)-->
	<select id="select_add_no" resultType="String">
		select low_dept_no from low_dept where dept_no=#{dept_no} and low_dept_name=#{low_dept_name} and his_check='1'
	</select>
	
	
	<!--하위 부서 등록하기 3)  -->
	<insert id="insert_homepage" parameterType="kr.or.epm.VO.LowDeptJoin">
		insert into set_homepage(set_date, low_dept_no, open, close)
		values(#{set_date}, #{low_dept_no}, #{open}, #{close})
	</insert>
	
	<!--하위 부서 등록하기 4)  -->
	<insert id="insert_time" parameterType="kr.or.epm.VO.LowDeptJoin">
	   insert into set_time(set_date, low_dept_no, in_time, out_time)
	   values(#{set_date}, #{low_dept_no}, #{in_time}, #{out_time})
	</insert>
	
	
	<!-- 하위 부서 수정하기, 아래 작업을 먼저 해야해 -->
	<update id="updateLow_dept">
		update low_dept
		set low_dept_no = low_dept_seq.nextval
    		dept_no = #{dept_no},
    		branch_name = #{branch_name},
    		dept_name = #{dept_name},
    		low_dept_name = #{low_dept_name},
    		tel = #{tel},
    		fax = #{fax},
    		pre_low_dept_no = low_dept_seq.currval -1,
    		his_check = '1',
    		depth = '2'
		where low_dept_no = #{low_dept_no}
	</update>
	
	<!-- 하위 부서 수정되면 최종 여부 0으로 변경하기 / 이전 하위 부서 등록하기 -->
	<update id="updateLow_dept_his">
		update low_dept
		set his_check = '0'
		where low_dept_no = #{low_dept_no}
	</update>
</mapper>