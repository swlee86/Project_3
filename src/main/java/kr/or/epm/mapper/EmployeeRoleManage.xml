<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--  
  작성자 : 이상원
  작성일 : 2016-11-21
  목  적 : 관리자 > 사원 권한 관리 DAO.xml
-->

<mapper namespace="kr.or.epm.DAO.EmployeeRoleManageDAO">

<!-- 사원관리 페이지를 열 때 사원정보를 모두 불러오는 쿼리문 -->
<select id="selectEmpRoleManage" resultType="kr.or.epm.VO.EmployeeRoleManage">
select rn, e.id, r.emp_no, r.emp_name, r.cg_name, r.branch_name, r.dept_name, r.low_dept_name, r.position_name, r.ROLE_NO, r.ROLE_NAME from ( select rownum rn, r.emp_no, r.emp_name, r.cg_name, r.branch_name, r.dept_name, r.low_dept_name, r.position_name, r.ROLE_NO, e.ROLE_NAME from (select r.emp_no, r.emp_name, r.cg_name, r.branch_name, r.dept_name, r.low_dept_name, r.position_name, e.ROLE_NO from(select r.emp_no, r.emp_name, r.cg_name, r.branch_name, r.dept_name, r.low_dept_name, p.position_name from(select r.emp_no, r.emp_name, e.cg_name, r.branch_name, r.dept_name, r.low_dept_name, r.position_no from (select e.emp_no, e.emp_name, e.cg_no, e.position_no, l.branch_name, l.dept_name, l.low_dept_name from emp e join low_dept l on e.low_dept_no=l.low_dept_no) r join emp_cg e on r.cg_no=e.cg_no) r join position p on r.position_no=p.position_no) r join emp_role e on r.emp_no= e.emp_no) r join role e on r.role_no=e.role_no) r join emp_detail e on r.emp_no=e.emp_no WHERE rn BETWEEN ${param1} AND ${param2}
</select>


<!-- 사원권한 관리 페이지를 열 때 사원정보를 불러오는 쿼리문 -->
<select id="selectEmpRoleManageId" resultType="kr.or.epm.VO.EmployeeRoleManage">
select rn, r.emp_no, r.emp_name, r.cg_name, r.branch_name, r.dept_name, r.low_dept_name, p.position_name from(select rownum rn, r.emp_no, r.emp_name, e.cg_name, r.branch_name, r.dept_name, r.low_dept_name, r.position_no from (select e.emp_no, e.emp_name, e.cg_no, e.position_no, l.branch_name, l.dept_name, l.low_dept_name from emp e join low_dept l on e.low_dept_no=l.low_dept_no) r join emp_cg e on r.cg_no=e.cg_no) r join position p on r.position_no=p.position_no WHERE rn BETWEEN ${param1} AND ${param2}
</select>

<!-- 사원 정보(EmpRole)의 총 갯수를 불러오는 쿼리문 -->
<select id="selectEmpRoleCount" resultType="int">
select count(*) from emp_role
</select>

<!-- 사원 권한 관리에서 권한 정보를 불러오는 쿼리문 -->
<select id="selectRoleList" resultType="kr.or.epm.VO.Role">
select role_no, role_name from role
</select>

<!-- 
<insert id="insertEmpRole">
	insert into emp_role(role_no, emp_no)
	values(#{role_no}, #{emp_no})
</insert>

<delete id="deleteEmpRole">
	delete from emp_role
	where emp_no = #{emp_no} and role_no = #{role_no}
</delete> 
-->

<!-- 권한 부여 -->
<update id="updateEmpRole">
	update emp_role
	set role_no = #{role_no}
	where emp_no = #{emp_no}
</update>

<!-- role_name에 따른 role_no 가져오기 -->
<select id="selectEmp_role_select" resultType="String">
	select role_no
	from role
	where role_name = #{role_name}
</select>

</mapper>